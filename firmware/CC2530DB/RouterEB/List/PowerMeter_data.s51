///////////////////////////////////////////////////////////////////////////////
//                                                                            /
// IAR C/C++ Compiler V8.30.1.41636 for 8051            04/Nov/2015  21:35:19 /
// Copyright 2004-2013 IAR Systems AB.                                        /
//                                                                            /
//    Core               =  plain                                             /
//    Code model         =  banked                                            /
//    Data model         =  large                                             /
//    Calling convention =  xdata reentrant                                   /
//    Constant location  =  data_rom                                          /
//    Dptr setup         =  1,16                                              /
//                                                                            /
//    Source file        =  C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\Source\PowerMeter_data.c                      /
//    Command line       =  -f C:\Users\paolo\Documents\GitHub\zpowermeter\fi /
//                          rmware\CC2530DB\..\Tools\f8wRouter.cfg            /
//                          (-DCPU32MHZ -DROOT=__near_func                    /
//                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                  /
//                          -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8        /
//                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f                  /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Tools\f8wConfig.cfg (-DZIGBEEPRO  /
//                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR      /
//                          -DDEFAULT_CHANLIST=0x00000800                     /
//                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                      /
//                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_M /
//                          ASK=0x007F -DBEACON_REQUEST_DELAY=100             /
//                          -DBEACON_REQ_DELAY_MASK=0x00FF                    /
//                          -DLINK_STATUS_JITTER_MASK=0x007F                  /
//                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_P /
//                          OLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7           /
//                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3   /
//                          -DNWK_MAX_DATA_RETRIES=2                          /
//                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9        /
//                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40          /
//                          -DNWK_MAX_BINDING_ENTRIES=4                       /
//                          -DMAX_BINDING_CLUSTER_IDS=4                       /
//                          "-DDEFAULT_KEY={0x01, 0x03, 0x05, 0x07, 0x09,     /
//                          0x0B, 0x0D, 0x0F, 0x00, 0x02, 0x04, 0x06, 0x08,   /
//                          0x0A, 0x0C, 0x0D}" -DMAC_MAX_FRAME_SIZE=116       /
//                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const    /
//                          __code" -DGENERIC=__generic                       /
//                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=5000       /
//                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100   /
//                          -DREJOIN_POLL_RATE=440) -f                        /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Tools\f8wZCL.cfg                  /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\Source\PowerMeter_data.c -D SECURE=0 -D       /
//                          OSC32K_CRYSTAL_INSTALLED=FALSE -D HAL_KEY=FALSE   /
//                          -D HAL_BOARD_CC2530EB_REV17 -D TC_LINKKEY_JOIN    /
//                          -D NV_INIT -D xNV_RESTORE -D                      /
//                          MULTICAST_ENABLED=FALSE -D ZCL_READ -D ZCL_WRITE  /
//                          -D ZCL_REPORT -D FEATURE_SYSTEM_STATS -lC         /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\RouterEB\List\ -lA                   /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\RouterEB\List\ --diag_suppress       /
//                          Pe001,Pa010 -o C:\Users\paolo\Documents\GitHub\zp /
//                          owermeter\firmware\CC2530DB\RouterEB\Obj\ -e      /
//                          --debug --core=plain --dptr=16,1                  /
//                          --data_model=large --code_model=banked            /
//                          --calling_convention=xdata_reentrant              /
//                          --place_constants=data_rom --nr_virtual_regs 16   /
//                          -I C:\Users\paolo\Documents\GitHub\zpowermeter\fi /
//                          rmware\CC2530DB\ -I C:\Users\paolo\Documents\GitH /
//                          ub\zpowermeter\firmware\CC2530DB\..\Source\ -I    /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Source\ha\ -I                     /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Source\zmain\ -I                  /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\hal\include\ -I        /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\hal\target\CC2530EB\   /
//                          -I C:\Users\paolo\Documents\GitHub\zpowermeter\fi /
//                          rmware\CC2530DB\..\Components\mac\include\ -I     /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\mac\high_level\ -I     /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\mac\low_level\srf04\   /
//                          -I C:\Users\paolo\Documents\GitHub\zpowermeter\fi /
//                          rmware\CC2530DB\..\Components\mac\low_level\srf04 /
//                          \single_chip\ -I C:\Users\paolo\Documents\GitHub\ /
//                          zpowermeter\firmware\CC2530DB\..\Components\mt\   /
//                          -I C:\Users\paolo\Documents\GitHub\zpowermeter\fi /
//                          rmware\CC2530DB\..\Components\osal\include\ -I    /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\services\saddr\ -I     /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\services\sdata\ -I     /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\stack\af\ -I           /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\stack\nwk\ -I          /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\stack\sapi\ -I         /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\stack\sec\ -I          /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\stack\sys\ -I          /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\stack\zcl\ -I          /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\stack\zdo\ -I          /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\zmac\ -I               /
//                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\..\Components\zmac\f8w\ -Ohz         /
//                          --require_prototypes                              /
//    List file          =  C:\Users\paolo\Documents\GitHub\zpowermeter\firmw /
//                          are\CC2530DB\RouterEB\List\PowerMeter_data.s51    /
//                                                                            /
//                                                                            /
///////////////////////////////////////////////////////////////////////////////

        NAME PowerMeter_data

        RTMODEL "__SystemLibrary", "CLib"
        RTMODEL "__calling_convention", "xdata_reentrant"
        RTMODEL "__code_model", "banked"
        RTMODEL "__core", "plain"
        RTMODEL "__data_model", "large"
        RTMODEL "__dptr_size", "16"
        RTMODEL "__extended_stack", "disabled"
        RTMODEL "__location_for_constants", "data"
        RTMODEL "__number_of_dptrs", "1"
        RTMODEL "__rt_version", "1"

        RSEG DOVERLAY:DATA:NOROOT(0)
        RSEG IOVERLAY:IDATA:NOROOT(0)
        RSEG ISTACK:IDATA:NOROOT(0)
        RSEG PSTACK:XDATA:NOROOT(0)
        RSEG XSTACK:XDATA:NOROOT(0)

        EXTERN __INIT_XDATA_I

        PUBLIC OnOff_SimpleDesc
        PUBLIC powerMeterAttrs
        PUBLIC powerMeter_InClusterList
        PUBLIC powerMeter_OutClusterList
`?<Name setIOStatus 0>` SYMBOL "setIOStatus"
??setIOStatus?relay SYMBOL "?relay", `?<Name setIOStatus 0>`

        EXTERN ??setIOStatus?relay
        FUNCTION ??setIOStatus?relay,00H
        EXTERN batteryAlarmMask
        EXTERN batteryVoltage
        EXTERN mainVoltage
        EXTERN onOffValue

// C:\Users\paolo\Documents\GitHub\zpowermeter\firmware\Source\PowerMeter_data.c
//    1 /**************************************************************************************************
//    2   Filename:       PowerMeter_data.c
//    3   Autorh: 		 Paolo Achdjia
//    4   Created: 13/10/2015
//    5 **************************************************************************************************/
//    6 
//    7 /*********************************************************************
//    8  * INCLUDES
//    9  */
//   10 #include "ZComDef.h"
//   11 #include "OSAL.h"
//   12 #include "AF.h"
//   13 #include "ZDConfig.h"
//   14 
//   15 #include "zcl.h"
//   16 #include "zcl_general.h"
//   17 #include "zcl_ha.h"
//   18 
//   19 #include "PowerMeter.h"
//   20 #include "clusters/ClusterIdentify.h"
//   21 #include "clusters/ClusterBasic.h"
//   22 #include "clusters/ClusterPower.h"
//   23 #include "clusters/ClusterOnOff.h"
//   24 
//   25 /*********************************************************************
//   26  * CONSTANTS
//   27  */
//   28 
//   29 #define DEVICE_VERSION     0
//   30 #define FLAGS              0
//   31 
//   32 
//   33 
//   34 /*********************************************************************
//   35  * ATTRIBUTE DEFINITIONS - Uses REAL cluster IDs
//   36  */

        RSEG CODE_C:CODE:REORDER:NOROOT(0)
        DATA8
//   37 CONST zclAttrRec_t powerMeterAttrs[] = {
powerMeterAttrs:
        DATA16
        DW 1
        DW 0
        DATA8
        DB 33
        DB 1
        DATA16
        DW mainVoltage
        DW 0H
        DB 0
        DW 1
        DW 32
        DATA8
        DB 32
        DB 1
        DATA16
        DW batteryVoltage
        DW 0H
        DB 0
        DW 1
        DW 53
        DATA8
        DB 24
        DB 1
        DATA16
        DW batteryAlarmMask
        DW 0H
        DB 0
        DW 6
        DW 0
        DATA8
        DB 16
        DB 1
        DATA16
        DW onOffValue
        DW ??setIOStatus?relay
        DB 0
        DW 65535
        DW 0
        DATA8
        DB 0
        DB 0
        DATA16
        DW 0H
        DB 0, 0, 0
//   38 	POWER_ATTRIBUTES
//   39 	ONOF_ATTRIBUTES
//   40  	LAST_CLUSTER_ATTRIBUTE
//   41 };
//   42 
//   43 /*********************************************************************
//   44  * SIMPLE DESCRIPTOR
//   45  */
//   46 // This is the Cluster ID List and should be filled with Application specific cluster IDs.
//   47 #define ZCLSAMPLELIGHT_MAX_INCLUSTERS       4

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA8
//   48 const cId_t powerMeter_InClusterList[ZCLSAMPLELIGHT_MAX_INCLUSTERS] ={
powerMeter_InClusterList:
        DATA16
        DW 0
        DW 3
        DW 1
        DW 6
//   49   ZCL_CLUSTER_ID_GEN_BASIC,
//   50   ZCL_CLUSTER_ID_GEN_IDENTIFY,
//   51   ZCL_CLUSTER_ID_GEN_POWER_CFG,
//   52   ZCL_CLUSTER_ID_GEN_ON_OFF
//   53 };
//   54 
//   55 #define ZCLSAMPLELIGHT_MAX_OUTCLUSTERS       1

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA16
//   56 const cId_t powerMeter_OutClusterList[ZCLSAMPLELIGHT_MAX_OUTCLUSTERS] ={
powerMeter_OutClusterList:
        DW 0
//   57   ZCL_CLUSTER_ID_GEN_BASIC
//   58 };
//   59 

        RSEG XDATA_I:XDATA:NOROOT(0)
//   60 SimpleDescriptionFormat_t OnOff_SimpleDesc = {
OnOff_SimpleDesc:
        DATA8
        DS 12
        REQUIRE `?<Initializer for OnOff_SimpleDesc>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for OnOff_SimpleDesc>`:
        DATA8
        DB 13
        DATA16
        DW 260
        DW 256
        DATA8
        DB 0
        DB 4
        DATA16
        DW powerMeter_InClusterList
        DATA8
        DB 1
        DATA16
        DW powerMeter_OutClusterList

        END
//   61   ENDPOINT_ONOFF,                  			//  int Endpoint;
//   62   ZCL_HA_PROFILE_ID,                	//  uint16 AppProfId[2];
//   63   ZCL_HA_DEVICEID_ON_OFF_LIGHT,     	//  uint16 AppDeviceId[2];
//   64   DEVICE_VERSION,           			//  int   AppDevVer:4;
//   65   FLAGS,                    			//  int   AppFlags:4;
//   66   ZCLSAMPLELIGHT_MAX_INCLUSTERS,        //  byte  AppNumInClusters;
//   67   (cId_t *)powerMeter_InClusterList, 	//  byte *pAppInClusterList;
//   68   ZCLSAMPLELIGHT_MAX_OUTCLUSTERS,       //  byte  AppNumInClusters;
//   69   (cId_t *)powerMeter_OutClusterList 	//  byte *pAppInClusterList;
//   70 };
//   71 
//   72 
//   73 
// 
// 55 bytes in segment CODE_C
// 12 bytes in segment XDATA_I
// 12 bytes in segment XDATA_ID
// 10 bytes in segment XDATA_ROM_C
// 
// 67 bytes of CODE  memory
// 10 bytes of CONST memory
// 12 bytes of XDATA memory
//
//Errors: none
//Warnings: none
